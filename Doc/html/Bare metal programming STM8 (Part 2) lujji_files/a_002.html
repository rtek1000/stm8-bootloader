<!DOCTYPE html>
<!--[if IE 8]><html lang="en" dir="ltr" class="ie8"><![endif]-->
<!--[if IE 9]><html lang="en" dir="ltr" class="ie9"><![endif]-->
<!--[if gt IE 9]><!-->
<html dir="ltr" class="js no-touch localstorage sessionstorage contenteditable use-opacity-transitions embed-refresh embed-refresh-v2" style="--publisher-color: rgb(37,143,184); --publisher-color-safe: rgb(37,143,184);" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Disqus Comments</title>

    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <style>
        .alert--warning {
            border-radius: 3px;
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: #FFE070;
            color: #A47703;
        }

        .alert--warning a,
        .alert--warning a:hover,
        .alert--warning strong {
            color: #A47703;
            font-weight: bold;
        }

        .alert--error p,
        .alert--warning p {
            margin-top: 5px;
            margin-bottom: 5px;
        }
        
        </style>
    
    <style>
        
        html {
            overflow: hidden;
        }
        

        #error {
            display: none;
        }

        .clearfix:after {
            content: "";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        
    </style>

<script crossorigin="anonymous" id="bootstrap-script" data-app="lounge" src="a_data_002/lounge.load.00fde7e349e9ee2566c5f117c45abf06.js"></script><meta http-equiv="Content-Security-Policy" content="script-src https:;"><link rel="stylesheet" href="a_data_002/lounge.cef06fba9afb581ee691b2d4ff616400.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="lounge/main" src="a_data_002/lounge.bundle.b29dff8af22e68239aefa0cfa712236c.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="remote/config" src="a_data_002/config.js"></script><style id="css_1681257451359"></style><!-- base href="https://disqus.com/embed/comments/?base=default&f=lujji&t_u=http%3A%2F%2Flujji.github.io%2Fblog%2Fbare-metal-programming-stm8-part2%2F&t_d=%0A%20%20%20%20%20%20Bare%20metal%20programming%3A%20STM8%20(Part%202)%0A%20%20%20%20&t_t=%0A%20%20%20%20%20%20Bare%20metal%20programming%3A%20STM8%20(Part%202)%0A%20%20%20%20&s_o=default" --><style type="text/css">@import url("https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,600;0,700;1,400;1,700&display=swap"); body.roboto , body.roboto input, body.roboto select, body.roboto textarea { font-family: Roboto, sans-serif; }</style></head>
<body class="roboto dark-anchor">
    

    
    <div id="error" class="alert--error">
        <p>We were unable to load Disqus. If you are a moderator please see our <a href="https://docs.disqus.com/help/83/"> troubleshooting guide</a>. </p>
    </div>

    
    <script type="text/json" id="disqus-forumData">{"session":{"canModerate":false,"audienceSyncVerified":false,"canReply":true,"mustVerify":false,"recaptchaPublicKey":"6Lfx6u0SAAAAAI1QkeTW397iQv1MsBfbDaYlwxK_","mustVerifyEmail":false},"forum":{"aetBannerConfirmation":null,"founder":"223501655","twitterName":null,"commentsLinkOne":"1 Comment","guidelines":null,"favicon":{"permalink":"https://disqus.com/api/forums/favicons/lujji.jpg","cache":"//a.disquscdn.com/1671639122/images/favicon-default.png"},"commentsLinkZero":"0 Comments","disableDisqusBranding":false,"id":"lujji","createdAt":"2016-09-17T08:44:29.135045","category":"Tech","aetBannerEnabled":false,"aetBannerTitle":null,"raw_guidelines":null,"initialCommentCount":null,"votingType":null,"daysUnapproveNewUsers":null,"installCompleted":false,"moderatorBadgeText":"","commentPolicyText":null,"aetEnabled":false,"channel":null,"sort":4,"description":null,"newPolicy":true,"raw_description":null,"customFont":null,"language":"en","adsReviewStatus":2,"commentsPlaceholderTextEmpty":null,"daysAlive":0,"forumCategory":{"date_added":"2016-01-28T01:54:31","id":8,"name":"Tech"},"linkColor":null,"colorScheme":"auto","pk":"4554663","commentsPlaceholderTextPopulated":null,"permissions":{},"commentPolicyLink":null,"aetBannerDescription":null,"name":"lujji's blog","commentsLinkMultiple":"{num} Comments","settings":{"threadRatingsEnabled":false,"adsDRNativeEnabled":false,"behindClickEnabled":false,"disable3rdPartyTrackers":true,"adsVideoEnabled":false,"adsProductVideoEnabled":false,"adsPositionTopEnabled":false,"ssoRequired":false,"unapproveLinks":false,"adsPositionRecommendationsEnabled":false,"linkAffiliationEnabled":false,"adsProductLinksThumbnailsEnabled":false,"hasCustomAvatar":false,"organicDiscoveryEnabled":false,"adsProductDisplayEnabled":false,"adsProductLinksEnabled":false,"audienceSyncEnabled":false,"threadReactionsEnabled":false,"adsEnabled":false,"disableSocialShare":false,"allowAnonPost":false,"adsProductStoriesEnabled":false,"sidebarEnabled":false,"adultContent":false,"allowAnonVotes":false,"gifPickerEnabled":true,"mustVerify":true,"badgesEnabled":false,"mustVerifyEmail":true,"unapproveNewUsersEnabled":false,"mediaembedEnabled":true,"userIdentityDisabled":false,"adsPositionBottomEnabled":false,"discoveryLocked":false,"validateAllPosts":false,"adsSettingsLocked":false,"isVIP":false,"adsPositionInthreadEnabled":false},"organizationId":3396437,"typeface":"auto","url":"http://lujji.github.io/blog","daysThreadAlive":0,"avatar":{"small":{"permalink":"https://disqus.com/api/forums/avatars/lujji.jpg?size=32","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"large":{"permalink":"https://disqus.com/api/forums/avatars/lujji.jpg?size=92","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"}},"signedUrl":"http://disq.us/?url=http%3A%2F%2Flujji.github.io%2Fblog&key=rRqx_aWyIoIe901vX2q7mA"}}</script>

    <script type="text/json" id="disqus-threadData">{"cursor":{"hasPrev":false,"prev":null,"total":16,"hasNext":false,"next":"1:0:0"},"code":0,"response":{"lastModified":1679084149,"posts":[{"editableUntil":"2017-04-18T17:35:39","dislikes":0,"thread":"5665856805","numReports":0,"likes":2,"message":"\u003cp>Dear Lujji, Thanks a lot, I've been monitoring your blog for a while being afraid I was too greedy to ask you so much before, and I'm glad you found the time to teach us more, hope we do not bother you and you are as interested in the subject as we are =^_^=\u003c/p>","id":"3251172658","createdAt":"2017-04-11T17:35:39","author":{"username":"disqus_mMEnKVg9HP","about":"","name":"\u0410\u043d\u043d\u0430 \u041c\u0430\u043a\u0430\u0440\u043e\u0432\u0430","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-03-08T19:59:20","profileUrl":"https://disqus.com/by/disqus_mMEnKVg9HP/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"244831312","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Dear Lujji, Thanks a lot, I've been monitoring your blog for a while being afraid I was too greedy to ask you so much before, and I'm glad you found the time to teach us more, hope we do not bother you and you are as interested in the subject as we are =^_^=","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":2,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2020-08-29T19:38:06","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Sdd ver 3.5 is available with apt-get in Raspbian.  Where would the stm8flash go?  Apt installed sdcc in /usr/bin and sdcc is an executeable, not a directory.. Could we use ~/local/sdcc to hold our code and the stmflash anyway?  Stm8flash won't compile on my Raspbian Stretch.  Found there is a windows version and it's files are compatable with STVP programmer.\u003c/p>","id":"5041057863","createdAt":"2020-08-22T19:38:06","author":{"username":"tannenba","about":"","name":"Joe","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2013-09-09T17:09:31","profileUrl":"https://disqus.com/by/tannenba/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"72293277","avatar":{"permalink":"https://disqus.com/api/users/avatars/tannenba.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/tannenba.jpg","cache":"https://c.disquscdn.com/uploads/users/7229/3277/avatar200.jpg?1648771427"},"cache":"https://c.disquscdn.com/uploads/users/7229/3277/avatar92.jpg?1648771427","large":{"permalink":"https://disqus.com/api/users/avatars/tannenba.jpg","cache":"https://c.disquscdn.com/uploads/users/7229/3277/avatar92.jpg?1648771427"},"small":{"permalink":"https://disqus.com/api/users/avatars/tannenba.jpg","cache":"https://c.disquscdn.com/uploads/users/7229/3277/avatar32.jpg?1648771427"},"isCustom":true}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Sdd ver 3.5 is available with apt-get in Raspbian.  Where would the stm8flash go?  Apt installed sdcc in /usr/bin and sdcc is an executeable, not a directory.. Could we use ~/local/sdcc to hold our code and the stmflash anyway?  Stm8flash won't compile on my Raspbian Stretch.  Found there is a windows version and it's files are compatable with STVP programmer.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2018-10-21T20:12:38","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Hello.\u003cbr>Thanks for the guide, but for some reason, I'm still not able to get it work properly. I always end with Error in complementary bytes (when I try to rad out back the option bytes in STVP)\u003cbr>I use SDCC, I checked what values are writen when I use graphic STVP and tried to set exactly the same.\u003cbr>I'm working with STM8s005k6, the setting is called in setup which is the first thing in main loop.\u003cbr>My code:\u003cbr>    // Set option bytes because of buzzer\u003cbr>    if(OPT-&gt;OPT2 != 0x80 || OPT-&gt;OPT3 != 0x08){\u003cbr>        FLASH-&gt;CR2 |= FLASH_CR2_OPT; //unlock option bytes for writing\u003cbr>         FLASH-&gt;NCR2 &amp;= (uint8_t)(~FLASH_NCR2_NOPT);\u003cbr>        while (!(FLASH-&gt;IAPSR &amp; FLASH_IAPSR_DUL));\u003c/p>\u003cp>        OPT-&gt;OPT2 = 0x80; // enable LSI clock source\u003cbr>        OPT-&gt;NOPT2 = 0x7f;\u003cbr>        OPT-&gt;OPT3 = 0x08; // set PD4 as alternative buzzer output\u003cbr>        OPT-&gt;NOPT3 = 0xf7;\u003cbr>        while (!(FLASH-&gt;IAPSR &amp; FLASH_IAPSR_EOP)); // wait for write finish\u003c/p>\u003cp>        FLASH-&gt;CR2 &amp;= (uint8_t)(~FLASH_CR2_OPT);    //lock back\u003cbr>          FLASH-&gt;NCR2 |= FLASH_NCR2_NOPT;\u003cbr>    }\u003c/p>\u003cp>Do you have any idea? :/\u003cbr>Thank you.\u003c/p>","id":"4144906264","createdAt":"2018-10-14T20:12:38","author":{"username":"daniel_bene","about":"","name":"Daniel Bene\u0161","disable3rdPartyTrackers":true,"isPowerContributor":false,"joinedAt":"2017-04-23T09:54:34","profileUrl":"https://disqus.com/by/daniel_bene/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"249717056","avatar":{"permalink":"https://disqus.com/api/users/avatars/daniel_bene.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/daniel_bene.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/daniel_bene.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/daniel_bene.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Hello.\nThanks for the guide, but for some reason, I'm still not able to get it work properly. I always end with Error in complementary bytes (when I try to rad out back the option bytes in STVP)\nI use SDCC, I checked what values are writen when I use graphic STVP and tried to set exactly the same.\nI'm working with STM8s005k6, the setting is called in setup which is the first thing in main loop.\nMy code:\n    // Set option bytes because of buzzer\n    if(OPT->OPT2 != 0x80 || OPT->OPT3 != 0x08){\n        FLASH->CR2 |= FLASH_CR2_OPT; //unlock option bytes for writing\n         FLASH->NCR2 &= (uint8_t)(~FLASH_NCR2_NOPT);\n        while (!(FLASH->IAPSR & FLASH_IAPSR_DUL));\n\n        OPT->OPT2 = 0x80; // enable LSI clock source\n        OPT->NOPT2 = 0x7f;\n        OPT->OPT3 = 0x08; // set PD4 as alternative buzzer output\n        OPT->NOPT3 = 0xf7;\n        while (!(FLASH->IAPSR & FLASH_IAPSR_EOP)); // wait for write finish\n\n        FLASH->CR2 &= (uint8_t)(~FLASH_CR2_OPT);    //lock back\n          FLASH->NCR2 |= FLASH_NCR2_NOPT;\n    }\n\nDo you have any idea? :/\nThank you.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-11-30T12:03:33","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Hi! The strange behavior of TIM4 isr was caused by low supply voltage. I have used 3,3V output of STLINK-V2 got from eBay, but in real it was about 2,7V what is not enoguh for 16MHz cpu clock. I have changed to external supply (trough micro USB) and I have got expected result using PD_ODR ^= (1 &lt;&lt; 3)\u003cbr>Insufficient optimization problem still exist, especially for bit manipulation :(\u003c/p>","id":"3629732603","createdAt":"2017-11-23T12:03:33","author":{"username":"disqus_zUDsoIMuYQ","about":"","name":"tovis","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-11-22T22:09:32","profileUrl":"https://disqus.com/by/disqus_zUDsoIMuYQ/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"271992919","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Hi! The strange behavior of TIM4 isr was caused by low supply voltage. I have used 3,3V output of STLINK-V2 got from eBay, but in real it was about 2,7V what is not enoguh for 16MHz cpu clock. I have changed to external supply (trough micro USB) and I have got expected result using PD_ODR ^= (1 \u003c\u003c 3)\nInsufficient optimization problem still exist, especially for bit manipulation :(","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-12-11T20:20:51","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>That time occasionally I have used SDCC 3.6.0! Later I've got 3.6.9 it's doing better.\u003c/p>","id":"3646452463","createdAt":"2017-12-04T20:20:51","author":{"username":"disqus_zUDsoIMuYQ","about":"","name":"tovis","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-11-22T22:09:32","profileUrl":"https://disqus.com/by/disqus_zUDsoIMuYQ/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"271992919","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3629732603,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"That time occasionally I have used SDCC 3.6.0! Later I've got 3.6.9 it's doing better.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-12-10T14:47:12","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Hi, glad you solved it. I actually covered code optimization in my bootloader article - some changes were made to SDCC since then, so bit manipulations are faster now. Also, you can check out my git repo for some additional optimization rules: \u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Flujji%2Fstm8-bare-min%2Fblob%2Fmaster%2Fstm8%2Futil%2Fextra.def%3AeDf_umSK7taw3jX_m0YwYtlUwMo&amp;cuid=4554663\" rel=\"nofollow noopener\" title=\"https://github.com/lujji/stm8-bare-min/blob/master/stm8/util/extra.def\">https://github.com/lujji/st...\u003c/a>\u003c/p>","id":"3644498953","createdAt":"2017-12-03T14:47:12","author":{"username":"disqus_Dga2cDKSKa","about":"","name":"lujji","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-09-17T12:36:59","profileUrl":"https://disqus.com/by/disqus_Dga2cDKSKa/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"223501655","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3629732603,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Hi, glad you solved it. I actually covered code optimization in my bootloader article - some changes were made to SDCC since then, so bit manipulations are faster now. Also, you can check out my git repo for some additional optimization rules: https://github.com/lujji/stm8-bare-min/blob/master/stm8/util/extra.def","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":1,"points":0,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2017-12-10T16:10:57","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>I'm glade to hear that you do not abandon this project. Now I'm stuck on UART - something wrong I'm sending 0xAA (usual test byte) but receive 0x80? I'm suspect level problems around MAX3232 used as a driver.\u003cbr>I will checkout boot loader later - I need to get working every peripherals.\u003cbr>Your work really helpful!\u003c/p>","id":"3644623198","createdAt":"2017-12-03T16:10:57","author":{"username":"disqus_zUDsoIMuYQ","about":"","name":"tovis","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-11-22T22:09:32","profileUrl":"https://disqus.com/by/disqus_zUDsoIMuYQ/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"271992919","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3644498953,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"I'm glade to hear that you do not abandon this project. Now I'm stuck on UART - something wrong I'm sending 0xAA (usual test byte) but receive 0x80? I'm suspect level problems around MAX3232 used as a driver.\nI will checkout boot loader later - I need to get working every peripherals.\nYour work really helpful!","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":2,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-11-29T22:21:32","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Well done! Thanks you that write it down!\u003cbr>I'm just now started to\u003cbr> explore this mcu and tools such as SDCC, but I quickly found some \u003cbr>problems. I have tried to build your/mine interrupt driven (1msec) tick \u003cbr>counter using TIM4. Use the same technic as you toggle port bit/pin and \u003cbr>put this code to isr:\u003cbr>PD_ODR  ^= 0B00001000;\u003cbr>TIM4_SR &amp;= 0B111111110;\u003cbr>(To compile this you need to put --std-sdcc99 option for sdcc)\u003cbr>The\u003cbr> result was really strange, instead of get a 50-50% duty cycle I have \u003cbr>got one pulse with 1msec the second about some nsec(!) and again a msec.\u003cbr> After struggling on C code I was take a look at assembly:\u003cbr>;    tick.c: 15: PD_ODR  ^= 0b00001000;  // toggle PD3 output\u003cbr>    ldw    x, #0x500f\u003cbr>    ld    a, (x)\u003cbr>    xor    a, #0x08\u003cbr>    ld    (x), a\u003cbr>;    tick.c: 17: TIM4_SR &amp;= 0b11111110;  // UIF bit\u003cbr>    bres    0x5344, #0\u003cbr>It seem to be OK, but not too good. I've changed my C code and use inline assembly:\u003cbr>__asm__ (\"bcpl 0x500F,#3\");\u003cbr>TIM4_SR &amp;= 0B111111110;\u003c/p>\u003cp>After compilation I've got:\u003c/p>\u003cp>;    tick.c: 17: __asm__(\"bcpl 0x500F,#3\");  // this is working!!!\u003cbr>    bcpl    0x500F,#3\u003cbr>;    tick.c: 18: TIM4_SR &amp;= 0b11111110;  // UIF bit\u003cbr>    bres    0x5344, #0\u003c/p>\u003cp>And\u003cbr> it is working as I awaited, 50-50% square wave. Problem, that I can not\u003cbr> use predefined constants, also bit complement is equal to bit xor!?\u003c/p>","id":"3629091550","createdAt":"2017-11-22T22:21:32","author":{"username":"disqus_zUDsoIMuYQ","about":"","name":"tovis","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-11-22T22:09:32","profileUrl":"https://disqus.com/by/disqus_zUDsoIMuYQ/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"271992919","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_zUDsoIMuYQ.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Well done! Thanks you that write it down!\nI'm just now started to\n explore this mcu and tools such as SDCC, but I quickly found some \nproblems. I have tried to build your/mine interrupt driven (1msec) tick \ncounter using TIM4. Use the same technic as you toggle port bit/pin and \nput this code to isr:\nPD_ODR  ^= 0B00001000;\nTIM4_SR &= 0B111111110;\n(To compile this you need to put --std-sdcc99 option for sdcc)\nThe\n result was really strange, instead of get a 50-50% duty cycle I have \ngot one pulse with 1msec the second about some nsec(!) and again a msec.\n After struggling on C code I was take a look at assembly:\n;    tick.c: 15: PD_ODR  ^= 0b00001000;  // toggle PD3 output\n    ldw    x, #0x500f\n    ld    a, (x)\n    xor    a, #0x08\n    ld    (x), a\n;    tick.c: 17: TIM4_SR &= 0b11111110;  // UIF bit\n    bres    0x5344, #0\nIt seem to be OK, but not too good. I've changed my C code and use inline assembly:\n__asm__ (\"bcpl 0x500F,#3\");\nTIM4_SR &= 0B111111110;\n\nAfter compilation I've got:\n\n;    tick.c: 17: __asm__(\"bcpl 0x500F,#3\");  // this is working!!!\n    bcpl    0x500F,#3\n;    tick.c: 18: TIM4_SR &= 0b11111110;  // UIF bit\n    bres    0x5344, #0\n\nAnd\n it is working as I awaited, 50-50% square wave. Problem, that I can not\n use predefined constants, also bit complement is equal to bit xor!?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2017-06-12T19:56:26","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Hello Lujji,\u003cbr>I see you used stm8flash\u003cbr>Do you happen to know how to sniff USB, so we can also start to flash more than 32kB?\u003cbr>Maybe sniff USB while sending limited range like 0x010000 - 0x010010 with ST Visual Progammer (Windows)\u003cbr>Somebody posted issue:\u003cbr>\u003ca href=\"https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fvdudouyt%2Fstm8flash%2Fissues%2F36%3Ae8xwPnrXEjAxi7vg1A_VGeC2ny8&amp;cuid=4554663\" rel=\"nofollow noopener\" title=\"https://github.com/vdudouyt/stm8flash/issues/36\">https://github.com/vdudouyt...\u003c/a>\u003cbr>Thanks\u003c/p>","id":"3342768941","createdAt":"2017-06-05T19:56:26","author":{"username":"ter_min4","about":"","name":"ter_min4","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-06-05T18:14:47","profileUrl":"https://disqus.com/by/ter_min4/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"254089027","avatar":{"permalink":"https://disqus.com/api/users/avatars/ter_min4.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/ter_min4.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/ter_min4.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/ter_min4.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Hello Lujji,\nI see you used stm8flash\nDo you happen to know how to sniff USB, so we can also start to flash more than 32kB?\nMaybe sniff USB while sending limited range like 0x010000 - 0x010010 with ST Visual Progammer (Windows)\nSomebody posted issue:\nhttps://github.com/vdudouyt/stm8flash/issues/36\nThanks","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":["links"],"isEdited":false,"sb":false},{"editableUntil":"2017-06-14T19:02:03","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Wireshark is the best tool for the job if you want to sniff USB. Unfortunately, I don't have any 64k parts on hand so I can't help much.\u003c/p>","id":"3346924740","createdAt":"2017-06-07T19:02:03","author":{"username":"disqus_Dga2cDKSKa","about":"","name":"lujji","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-09-17T12:36:59","profileUrl":"https://disqus.com/by/disqus_Dga2cDKSKa/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"223501655","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3342768941,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Wireshark is the best tool for the job if you want to sniff USB. Unfortunately, I don't have any 64k parts on hand so I can't help much.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-05-04T14:23:30","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>I've encountered \u003ca href=\"http://disq.us/url?url=http%3A%2F%2Fwww.st.com%2Fen%2Fdevelopment-tools%2Fstm8cubemx.html%3A51jsc4XfMgrWdj7RmCBoPuILdxs&amp;cuid=4554663\" rel=\"nofollow noopener\" title=\"http://www.st.com/en/development-tools/stm8cubemx.html\">http://www.st.com/en/develo...\u003c/a>\u003cbr>Runs on my Linux Mint very well. Unfortunatelly, does not really generate code templates with HW initializations (yet?). I''m reading their manual just now. Power calculator section in the app hints that power consumption is different for the code being executed from RAM compared to FLASH. Speed can be different also. Have you tries to place your code in RAM and gather some real experience?\u003c/p>","id":"3277049118","createdAt":"2017-04-27T14:23:30","author":{"username":"disqus_mMEnKVg9HP","about":"","name":"\u0410\u043d\u043d\u0430 \u041c\u0430\u043a\u0430\u0440\u043e\u0432\u0430","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-03-08T19:59:20","profileUrl":"https://disqus.com/by/disqus_mMEnKVg9HP/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"244831312","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"I've encountered http://www.st.com/en/development-tools/stm8cubemx.html\nRuns on my Linux Mint very well. Unfortunatelly, does not really generate code templates with HW initializations (yet?). I''m reading their manual just now. Power calculator section in the app hints that power consumption is different for the code being executed from RAM compared to FLASH. Speed can be different also. Have you tries to place your code in RAM and gather some real experience?","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":["links"],"isEdited":true,"sb":false},{"editableUntil":"2017-05-05T12:49:19","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Apparently, on some STM8's people copy some code to RAM then jump there turning FLASH memory off completely somehow. Together with low power oscillator it allows them to conserve lots of power while not sleeping entirely. I wonder if it's possible on the cheapest one we have. Also there is FLASH overclocking limitation that could be potentially overridden with RAM fetching. I wonder how many people have tried to squeeze as much as possible from STM8003 in terms mentioned above (starting from extreme power saving while working from RAM, till extreme overclocking yet with the same RAM-based code).\u003c/p>","id":"3278713069","createdAt":"2017-04-28T12:49:19","author":{"username":"disqus_mMEnKVg9HP","about":"","name":"\u0410\u043d\u043d\u0430 \u041c\u0430\u043a\u0430\u0440\u043e\u0432\u0430","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-03-08T19:59:20","profileUrl":"https://disqus.com/by/disqus_mMEnKVg9HP/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"244831312","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3277049118,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Apparently, on some STM8's people copy some code to RAM then jump there turning FLASH memory off completely somehow. Together with low power oscillator it allows them to conserve lots of power while not sleeping entirely. I wonder if it's possible on the cheapest one we have. Also there is FLASH overclocking limitation that could be potentially overridden with RAM fetching. I wonder how many people have tried to squeeze as much as possible from STM8003 in terms mentioned above (starting from extreme power saving while working from RAM, till extreme overclocking yet with the same RAM-based code).","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":1,"points":0,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-05-06T00:10:44","dislikes":0,"thread":"5665856805","numReports":0,"likes":1,"message":"\u003cp>I haven't tried executing code from RAM - I'll need to figure out if it's possible to create a separate RAM section with sdcc's linker. Also Cosmic has some built-in functions for copying things into RAM which would probably need to be re-implemented in assembly for sdcc. According to the datasheet the difference in power consumption between executing from flash and RAM is about 3% when running on 128kHz LSI, which is negligible. Turning the flash off seems to make a huge difference in halt mode.\u003c/p>","id":"3279741884","createdAt":"2017-04-29T00:10:44","author":{"username":"disqus_Dga2cDKSKa","about":"","name":"lujji","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-09-17T12:36:59","profileUrl":"https://disqus.com/by/disqus_Dga2cDKSKa/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"223501655","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3278713069,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"I haven't tried executing code from RAM - I'll need to figure out if it's possible to create a separate RAM section with sdcc's linker. Also Cosmic has some built-in functions for copying things into RAM which would probably need to be re-implemented in assembly for sdcc. According to the datasheet the difference in power consumption between executing from flash and RAM is about 3% when running on 128kHz LSI, which is negligible. Turning the flash off seems to make a huge difference in halt mode.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":2,"points":1,"moderationLabels":[],"isEdited":false,"sb":false},{"editableUntil":"2017-04-21T09:37:38","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>AC clocking was epic, and it was fun to find out than ST themselves use AC mains as sample frequency source to trim internal HSI generator compensation voltage and temperature determined drift. Actually, I'm interested in realtime HSI frequency calibration while emulating some high-speed protocols\\signals where clock accuracy is essential. This principleis used in various vUSB implementations even in crystal-less mass-produced USB devices.\u003cbr>ST recommends calibration examples from \"firmware library\", but last mention of it was 6 years ago and I can not find it after their site rebuilt.\u003c/p>\u003cp>Has anyone tried to play with HSI trimming in realtime? The calibration range seems to be not too wide (-4..+3) and I wonder if it is enough and are there any glitches during runtime.\u003c/p>\u003cp>Talking about internal memories of STM8, I wonder what are their top frequencies (while overclocking), especially while working on low-voltage batteries...\u003c/p>","id":"3255631537","createdAt":"2017-04-14T09:37:38","author":{"username":"disqus_mMEnKVg9HP","about":"","name":"\u0410\u043d\u043d\u0430 \u041c\u0430\u043a\u0430\u0440\u043e\u0432\u0430","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-03-08T19:59:20","profileUrl":"https://disqus.com/by/disqus_mMEnKVg9HP/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"244831312","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":null,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"AC clocking was epic, and it was fun to find out than ST themselves use AC mains as sample frequency source to trim internal HSI generator compensation voltage and temperature determined drift. Actually, I'm interested in realtime HSI frequency calibration while emulating some high-speed protocols\\signals where clock accuracy is essential. This principleis used in various vUSB implementations even in crystal-less mass-produced USB devices.\nST recommends calibration examples from \"firmware library\", but last mention of it was 6 years ago and I can not find it after their site rebuilt.\n\nHas anyone tried to play with HSI trimming in realtime? The calibration range seems to be not too wide (-4..+3) and I wonder if it is enough and are there any glitches during runtime.\n\nTalking about internal memories of STM8, I wonder what are their top frequencies (while overclocking), especially while working on low-voltage batteries...","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":0,"points":0,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2017-04-21T22:43:49","dislikes":0,"thread":"5665856805","numReports":0,"likes":1,"message":"\u003cp>I haven't read this appnote before and was a bit surprised that ST used mains as frequency reference.\u003cbr>Adjusting HSI trimming value on the fly is possible, the transition is glitch-free. Actually, the first thing I thought about was frequency modulation - too bad there's no internal PLL.\u003cbr>edit: your reply was blocked by disqus for some reason - fixed.\u003c/p>","id":"3256597156","createdAt":"2017-04-14T22:43:49","author":{"username":"disqus_Dga2cDKSKa","about":"","name":"lujji","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2016-09-17T12:36:59","profileUrl":"https://disqus.com/by/disqus_Dga2cDKSKa/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"223501655","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_Dga2cDKSKa.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3255631537,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"I haven't read this appnote before and was a bit surprised that ST used mains as frequency reference.\nAdjusting HSI trimming value on the fly is possible, the transition is glitch-free. Actually, the first thing I thought about was frequency modulation - too bad there's no internal PLL.\nedit: your reply was blocked by disqus for some reason - fixed.","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":1,"points":1,"moderationLabels":[],"isEdited":true,"sb":false},{"editableUntil":"2017-04-22T10:14:33","dislikes":0,"thread":"5665856805","numReports":0,"likes":0,"message":"\u003cp>Absence of PLL disappoints me too. Some protocols do need basic frequencies different from even harmonics of 16Mhz (slow USB needs multiples of 12 Mhz, slow Ethernet - 10Mhz, etc.). Being unable to use external crystal we'll stuck with indirect target frequency reconstruction based on received signals from it and real-time phase\\frequency compensation of our own clock (basically it's a \u0440\u0435rv\u0435rt\u0435d kind of software-emulated PLL). As far as I understand, overclocking is possible only with external crystal too. People use 40 Mhz external crystal, divide it by 2 and clock the core at 20 Mhz while peripherals run at 40 MHz. Division by 2 is used cause apparently flash can not be read at 40 Mhz.\u003c/p>\u003cp>edit: my reply contains one suspicious word leading to automated blockage, now I encoded with some tricks)\u003c/p>","id":"3257109452","createdAt":"2017-04-15T10:14:33","author":{"username":"disqus_mMEnKVg9HP","about":"","name":"\u0410\u043d\u043d\u0430 \u041c\u0430\u043a\u0430\u0440\u043e\u0432\u0430","disable3rdPartyTrackers":false,"isPowerContributor":false,"joinedAt":"2017-03-08T19:59:20","profileUrl":"https://disqus.com/by/disqus_mMEnKVg9HP/","url":"","location":"","isPrivate":false,"signedUrl":"","isPrimary":true,"isAnonymous":false,"id":"244831312","avatar":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","xlarge":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar128.png"},"cache":"//a.disquscdn.com/1671639122/images/noavatar92.png","large":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar92.png"},"small":{"permalink":"https://disqus.com/api/users/avatars/disqus_mMEnKVg9HP.jpg","cache":"//a.disquscdn.com/1671639122/images/noavatar32.png"},"isCustom":false}},"media":[],"isSpam":false,"hasMore":false,"isDeleted":false,"isDeletedByAuthor":false,"parent":3256597156,"isApproved":true,"isNewUserNeedsApproval":false,"isFlagged":false,"raw_message":"Absence of PLL disappoints me too. Some protocols do need basic frequencies different from even harmonics of 16Mhz (slow USB needs multiples of 12 Mhz, slow Ethernet - 10Mhz, etc.). Being unable to use external crystal we'll stuck with indirect target frequency reconstruction based on received signals from it and real-time phase\\frequency compensation of our own clock (basically it's a \u0440\u0435rv\u0435rt\u0435d kind of software-emulated PLL). As far as I understand, overclocking is possible only with external crystal too. People use 40 Mhz external crystal, divide it by 2 and clock the core at 20 Mhz while peripherals run at 40 MHz. Division by 2 is used cause apparently flash can not be read at 40 Mhz.\n\nedit: my reply contains one suspicious word leading to automated blockage, now I encoded with some tricks)","isAtFlagLimit":false,"isHighlighted":false,"canVote":false,"forum":"lujji","depth":2,"points":0,"moderationLabels":[],"isEdited":true,"sb":false}],"thread":{"feed":"https://lujji.disqus.com/bare_metal_programming_stm8_part_2/latest.rss","clean_title":"Bare metal programming: STM8 (Part 2)","dislikes":0,"likes":1,"message":"","ratingsEnabled":false,"isSpam":false,"isDeleted":false,"category":"5471855","adsDisabled":false,"author":"223501655","id":"5665856805","signedLink":"http://disq.us/?url=http%3A%2F%2Flujji.github.io%2Fblog%2Fbare-metal-programming-stm8-part2%2F&key=IoEjs4oDolQRavKhFZmngA","createdAt":"2017-03-25T21:59:55","hasStreaming":false,"raw_message":"","isClosed":false,"link":"http://lujji.github.io/blog/bare-metal-programming-stm8-part2/","slug":"bare_metal_programming_stm8_part_2","forum":"lujji","identifiers":[],"posts":16,"moderators":[223501655],"validateAllPosts":false,"title":"\n      Bare metal programming: STM8 (Part 2)\n    ","highlightedPost":null}},"order":"popular"}</script>


    <div id="fixed-content"></div>


    
        
            
<script type="text/json" id="disqus-urls">{
    "root":"//disqus.com",
    "next":"https://c.disquscdn.com/next/current"
}</script>

        
        
        <script>!function () {
            var d = document;
            var toH = d.head.appendChild.bind(d.head);

            var v = window.location.href.match(/[#&?]version=([0-9a-f]{32})/);
            var src = 'https://c.disquscdn.com/next/embed/lounge.load';
            if (v)
                src += '.' + v[1];
            src += '.js';

            var s = d.createElement('script');
            s.crossOrigin = 'anonymous';
            s.id = 'bootstrap-script';
            s.setAttribute('data-app', 'lounge');
            s.src = src;
            toH(s);

            var m = d.createElement('meta');
            m.setAttribute('http-equiv', 'Content-Security-Policy');
            m.setAttribute('content', "script-src https:;");
            toH(m);
        }();</script>
    


<script src="a_data_002/common.bundle.6719fe9dbe70a5a047052a905ea1cbc5.js"></script><div id="layout" data-tracking-area="layout"><div id="thread__container"><div><div id="thread__wrapper"><div id="placement-top" data-tracking-area="discovery-north"></div><div id="onboard" data-tracking-area="onboard"></div><div id="reactions__container"></div><div id="ratings__container"></div><div id="badges-message__container"></div><div id="global-alert"></div><div id="tos__container"></div><header id="main-nav" data-tracking-area="main-nav"><div><nav class="nav nav-primary nav-primary--refresh"><ul><li class="nav-tab nav-tab--primary tab-conversation tab-conversation--refresh active" data-role="post-count"><a class="publisher-nav-color"><span class="comment-count">16 comments</span></a></li><li class="nav-tab nav-tab--primary tab-user"><ul><li class="nav-tab nav-tab--primary notification-menu unread" data-role="notification-menu" style="display: list-item;"><a href="https://disqus.com/home/inbox/" class="notification-container" data-action="home" data-home-path="home/notifications/"><span class="notification-icon notification-icon--refresh icon-comment" aria-hidden="true"></span><span class="notification-count notification-count--refresh" data-role="notification-count">1</span></a></li><li class="nav-tab nav-tab--primary dropdown user-menu media-collapsed" data-role="logout"><a href="#" class="dropdown-toggle dropdown-toggle--refresh" data-toggle="dropdown" role="menuitem" name="Login"><span class="dropdown-toggle-wrapper"><span class="username username--refresh">Login</span> </span> <span class="caret caret--refresh"></span></a><ul class="dropdown-menu dropdown-menu--refresh"><li><a href="#" data-action="auth:disqus">Disqus</a></li><li><a href="#" data-action="auth:facebook">Facebook</a></li><li><a href="#" data-action="auth:twitter">Twitter</a></li><li><a href="#" data-action="auth:google">Google</a></li></ul></li></ul></li></ul></nav></div></header><section id="conversation" data-role="main" data-tracking-area="main"><div id="posts"><div id="form" class="textarea-outer-wrapper--top-level"><form class="reply form-refresh form-refresh-v2"><div class="postbox"><div role="alert"></div><div class="ratings-wrapper" data-role="ratings-container"></div><div class="compose-wrapper"><div class="avatar"><span class="user user--refresh"><div>G</div></span></div><div class="textarea-outer-wrapper textarea-outer-wrapper--refresh"><div class="textarea-wrapper" data-role="textarea" dir="auto"><div><span class="placeholder">Join the discussion…</span><div class="textarea" tabindex="0" role="textbox" aria-multiline="true" data-role="editable" style="overflow: auto; overflow-wrap: break-word; max-height: 350px;" aria-label="Join the discussion…" contenteditable="true"><p><br></p></div><div style="display: none;"><ul class="user-mention__list" id="user-mention-list"><li class="header user-mention__header"><h5>in this conversation</h5></li></ul></div></div><div data-role="drag-drop-placeholder" class="media-drag-hover" style="display: none;"><div class="drag-text">⬇ Drag and drop your images here to upload them.</div></div><div class="media-preview empty" data-role="media-preview"><ul data-role="media-progress-list"></ul>
<ul data-role="media-rich-list"></ul>
<div class="media-expanded empty" data-role="media-preview-expanded">
<img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-role="media-preview-expanded-image" alt="Media preview placeholder">
</div>
</div><div class="edit-alert" role="postbox-alert"></div><div class="text-editor-container"><div class="post-actions"><div class="wysiwyg"><div class="gif-picker"><div class="wysiwyg__item" data-role="gif-picker-toggle" title="GIF" aria-label="Open GIF menu" tabindex="0"><div class="wysiwyg__gif" title="GIF" role="img"></div></div><div class="hidden gif-picker__popout-container" data-role="gif-picker-popout-container"></div><div class="new-feature-badge-star" title="New"><div class="wysiwyg__star-badge wysiwyg__star-badge-dims"></div></div></div><div class="media-uploader"><li class="wysiwyg__item" data-role="media-uploader" tabindex="-1"><a href="#" data-action="attach" class="attach" title="Upload Images" tabindex="0" aria-label="Open file attachment menu">
<div class="wysiwyg__attach wysiwyg__attach-dims" role="img"></div>
</a>
<input type="file" data-role="media-upload" tabindex="-1" accept="image/*">
</li></div><div class="vertical-separator"></div><div data-action="text-editor-buttons"><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="b" tabindex="0" aria-label="Add bold tags to text editor"><div class="wysiwyg__bold" title="Bold" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="i" tabindex="0" aria-label="Add italics tags to text editor"><div class="wysiwyg__italic" title="Italic" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="u" tabindex="0" aria-label="Add underline tags to text editor"><div class="wysiwyg__underline" title="Underline" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="s" tabindex="0" aria-label="Add strikethrough tags to text editor"><div class="wysiwyg__strikethrough" title="Strikethrough" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="a" tabindex="0" aria-label="Add link tags to text editor"><div class="wysiwyg__link" title="Link" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="spoiler" tabindex="0" aria-label="Add spoiler tags to text editor"><div class="wysiwyg__spoiler" title="Spoiler" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="code" tabindex="0" aria-label="Add code tags to text editor"><div class="wysiwyg__code" title="Code" role="img"></div></div><div class="wysiwyg__item" data-action="text-editor-tag" data-tag="blockquote" tabindex="0" aria-label="Add block quote tags to text editor"><div class="wysiwyg__blockquote" title="Quote" role="img"></div></div></div></div><div class="logged-in"><section><div class="temp-post"><button type="submit" class="btn post-action__button full-size-button ">Comment</button><button type="submit" class="btn post-action__button small-size-button hidden">Comment</button></div></section></div></div></div></div></div></div><div data-role="login-form"><div><div><section class="auth-section logged-out__display"><div class="connect"><h6 class="connect__heading">Log in with</h6><ul data-role="login-menu" class="services login-buttons"><li class="auth-disqus"><button type="button" data-action="auth:disqus" title="Disqus" class="connect__button" aria-label="Login with Disqus"><i class="icon-disqus"></i></button></li><li class="auth-facebook"><button type="button" data-action="auth:facebook" title="Facebook" class="connect__button" aria-label="Login with Facebook"><i class="icon-facebook-circle"></i></button></li><li class="auth-twitter"><button type="button" data-action="auth:twitter" title="Twitter" class="connect__button" aria-label="Login with Twitter"><i class="icon-twitter-circle"></i></button></li><li class="auth-google"><button type="button" data-action="auth:google" title="Google" class="connect__button" aria-label="Login with Google"><i class="icon-google-plus-circle"></i></button></li></ul></div><div class="guest guest--refresh"><div class="sign-up-wrapper-refresh"><h6 class="guest-form-title guest-form-title--refresh"><span class="register-text"> or sign up with Disqus </span><span class="guest-text"> or pick a name </span></h6> <button type="button" class="help-tooltip__wrapper help-icon" name="guest_tooltip" tabindex="0"><div id="rules" class="help-tooltip__container" data-role="guest-form-tooltip"><div class="tooltip show help-tooltip"><h3 class="help-tooltip__heading">Disqus is a discussion network</h3><ul class="help-tooltip__list"><li><span>Don't be a jerk or do anything illegal. Everything is easier that way.</span></li></ul><p class="clearfix"><a href="https://docs.disqus.com/kb/terms-and-policies/" class="btn btn-small help-tooltip__button" rel="noopener noreferrer" target="_blank">Read full terms and conditions</a></p></div></div></button></div><p class="input-wrapper"><input dir="auto" type="text" placeholder="Name" name="display_name" id="view53_display_name" maxlength="30" class="input--text" aria-label="name"></p><div class="guest-details " data-role="guest-details"><p class="input-wrapper"><input dir="auto" type="email" placeholder="Email" name="email" id="view53_email" class="input--text" aria-label="email"></p><p class="input-wrapper"><input dir="auto" disabled="disabled" type="text" class="register-text input--text" placeholder="Password" name="password" aria-label="password" id="view53_password"></p><div class="acceptance-wrapper"><p><label><input type="checkbox" name="tos"><span class="spacing-left-small">I agree to Disqus' <a href="https://help.disqus.com/customer/portal/articles/466260-terms-of-service" target="_blank" rel="noopener noreferrer">Terms of Service</a></span></label></p><p><label><input type="checkbox" name="privacy-policy"><span class="spacing-left-small">I
 agree to Disqus' processing of email and IP address, and the use of 
cookies, to facilitate my authentication and posting of comments, 
explained further in the <a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" target="_blank" rel="noopener noreferrer">Privacy Policy</a></span></label></p><p><label><input type="checkbox" name="data-sharing"><span class="spacing-left-small">I
 agree to additional processing of my information, including first and 
third party cookies, for personalized content and advertising as 
outlined in our <a href="https://disqus.com/data-sharing-settings/">Data Sharing Policy</a></span></label></p></div><input type="checkbox" name="author-guest" style="display: none;"><div class="g-recaptcha" data-role="grecaptcha-container"></div><div class="proceed" data-role="submit-btn-container"><button type="submit" class="proceed__button btn submit" aria-label="Next"><span class="icon-proceed"></span><div class="spinner"></div></button></div></div></div></section></div></div></div></div></form></div><div id="email-signup"></div><div id="secondary-navigation"><div data-tracking-area="secondary-nav" class="nav-secondary-refresh"><ul class="nav-secondary-refresh__list"><li class="nav-secondary-refresh__list-item"><div id="favorite-button"><div class="thread-likes"><div><a href="#" data-action="favorite" title="Favorite this discussion" class="favorite-button-toggle favorite-button-toggle--v2 " aria-label="Favorite this discussion"><span class="label label-default"><span class="favorite-icon favorite-icon--refresh-v2 icon-heart-empty"></span></span><span class="label label-favorited"><span class="favorite-icon favorite-icon--refresh-v2 icon-heart"></span></span> <span class="label label-count-refresh label-count-refresh--v2">1</span></a><ul class="dropdown-menu dropdown-menu--coachmark pull-right"><li><div><h2 class="coachmark__heading">Discussion Favorited!</h2><p class="coachmark__description">Favoriting means this is a discussion worth sharing. It gets shared to your followers' Disqus feeds, and gives the creator kudos!</p></div> <a href="https://disqus.com/home/?utm_source=disqus_embed&amp;utm_content=recommend_btn" class="btn btn-primary coachmark__button" target="_blank" rel="noopener noreferrer">Find More Discussions</a></li></ul></div></div></div><div id="thread-share-bar" class="share-bar-refresh"><div class="thread-share-wrapper"><div class="round-delimiter"></div><span data-role="thread-share" class="thread-share-bar-buttons-refresh"><a href="#" class="share-button-toggle share-button-toggle--v2" data-toggle="dropdown" aria-label="Share">Share</a><ul class="share-dropdown-refresh"><li class="share-dropdown-refresh__item"><div class="share-icons-wrapper share-icons-wrapper--twitter" data-action="share:twitter"><span class="icon-twitter" aria-hidden="true"></span><span class="visually-hidden">Tweet this discussion</span></div></li><li class="share-dropdown-refresh__item"><div class="share-icons-wrapper share-icons-wrapper--facebook" data-action="share:facebook"><span class="icon-facebook" aria-hidden="true"></span><span class="visually-hidden">Share this discussion on Facebook</span></div></li></ul></span></div></div></li><li data-role="post-sort" class=""><ul class="sort-menu-refresh"><li class="sort-menu-refresh__item selected"><a href="#" data-action="sort" data-sort="popular">Best</a></li><li class="sort-menu-refresh__item "><a href="#" data-action="sort" data-sort="desc">Newest</a></li><li class="sort-menu-refresh__item "><a href="#" data-action="sort" data-sort="asc">Oldest</a></li></ul></li></ul></div></div><div id="no-posts" style="display: none;"></div><div id="highlighted-post" data-tracking-area="highlighted" class="highlighted-post" style="display: none;"></div><button class="alert alert--realtime alert--realtime--refresh alert--realtime--refresh-v2" style="display: none;" data-role="realtime-notification"></button><ul id="post-list" class="post-list"><li class="post" id="post-3251172658"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3251172658"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>А</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer">Анна Макарова</a></span> <a data-action="follow" data-user="244831312" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3251172658" data-role="relative-time" class="time-ago" title="Tuesday, April 11, 2017 2:35 PM">6 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Dear
 Lujji, Thanks a lot, I've been monitoring your blog for a while being 
afraid I was too greedy to ask you so much before, and I'm glad you 
found the time to teach us more, hope we do not bother you and you are 
as interested in the subject as we are =^_^=</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-2" data-action="upvote" title="" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">2</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3251172658" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1hrnwvm" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1hrnwvm"></li></ul></li><li class="realtime" data-role="realtime-notification:3251172658"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3251172658-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-5041057863"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="5041057863"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/tannenba/" data-action="profile" data-tab="" data-username="tannenba" target="_blank" rel="noopener noreferrer" class="user user--refresh"><img data-role="user-avatar" data-user="72293277" src="a_data_002/noavatar92.png" alt="Avatar" class="image-refresh"></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/tannenba/" data-action="profile" data-tab="" data-username="tannenba" target="_blank" rel="noopener noreferrer">Joe</a></span> <a data-action="follow" data-user="72293277" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-5041057863" data-role="relative-time" class="time-ago" title="Saturday, August 22, 2020 4:38 PM">3 years ago</a> <span> <span class="has-edit" data-role="has-edit">edited</span></span></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Sdd
 ver 3.5 is available with apt-get in Raspbian.  Where would the 
stm8flash go?  Apt installed sdcc in /usr/bin and sdcc is an 
executeable, not a directory.. Could we use ~/local/sdcc to hold our 
code and the stmflash anyway?  Stm8flash won't compile on my Raspbian 
Stretch.  Found there is a windows version and it's files are compatable
 with STVP programmer.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-5041057863" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/2bdbd53" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/2bdbd53"></li></ul></li><li class="realtime" data-role="realtime-notification:5041057863"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-5041057863-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-4144906264"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="4144906264"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/daniel_bene/" data-action="profile" data-tab="" data-username="daniel_bene" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>D</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/daniel_bene/" data-action="profile" data-tab="" data-username="daniel_bene" target="_blank" rel="noopener noreferrer">Daniel Beneš</a></span> <a data-action="follow" data-user="249717056" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-4144906264" data-role="relative-time" class="time-ago" title="Sunday, October 14, 2018 5:12 PM">4 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hello.<br>Thanks
 for the guide, but for some reason, I'm still not able to get it work 
properly. I always end with Error in complementary bytes (when I try to 
rad out back the option bytes in STVP)<br>I use SDCC, I checked what values are writen when I use graphic STVP and tried to set exactly the same.<br>I'm working with STM8s005k6, the setting is called in setup which is the first thing in main loop.<br>My code:<br>    // Set option bytes because of buzzer<br>    if(OPT-&gt;OPT2 != 0x80 || OPT-&gt;OPT3 != 0x08){<br>        FLASH-&gt;CR2 |= FLASH_CR2_OPT; //unlock option bytes for writing<br>         FLASH-&gt;NCR2 &amp;= (uint8_t)(~FLASH_NCR2_NOPT);<br>        while (!(FLASH-&gt;IAPSR &amp; FLASH_IAPSR_DUL));</p><p>        OPT-&gt;OPT2 = 0x80; // enable LSI clock source<br>        OPT-&gt;NOPT2 = 0x7f;<br>        OPT-&gt;OPT3 = 0x08; // set PD4 as alternative buzzer output<br>        OPT-&gt;NOPT3 = 0xf7;<br>        while (!(FLASH-&gt;IAPSR &amp; FLASH_IAPSR_EOP)); // wait for write finish</p><p>        FLASH-&gt;CR2 &amp;= (uint8_t)(~FLASH_CR2_OPT);    //lock back<br>          FLASH-&gt;NCR2 |= FLASH_NCR2_NOPT;<br>    }</p><p>Do you have any idea? :/<br>Thank you.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-4144906264" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1wjrq54" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1wjrq54"></li></ul></li><li class="realtime" data-role="realtime-notification:4144906264"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-4144906264-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3629732603"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3629732603"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>T</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer">tovis</a></span> <a data-action="follow" data-user="271992919" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3629732603" data-role="relative-time" class="time-ago" title="Thursday, November 23, 2017 10:03 AM">5 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hi!
 The strange behavior of TIM4 isr was caused by low supply voltage. I 
have used 3,3V output of STLINK-V2 got from eBay, but in real it was 
about 2,7V what is not enoguh for 16MHz cpu clock. I have changed to 
external supply (trough micro USB) and I have got expected result using 
PD_ODR ^= (1 &lt;&lt; 3)<br>Insufficient optimization problem still exist, especially for bit manipulation :(</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3629732603" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1o11rln" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1o11rln"></li></ul></li><li class="realtime" data-role="realtime-notification:3629732603"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3646452463"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3646452463"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>T</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer">tovis</a></span> <a data-action="follow" data-user="271992919" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3629732603" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> tovis</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3646452463" data-role="relative-time" class="time-ago" title="Monday, December 4, 2017 6:20 PM">5 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>That time occasionally I have used SDCC 3.6.0! Later I've got 3.6.9 it's doing better.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3646452463" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1ob04q7" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1ob04q7"></li></ul></li><li class="realtime" data-role="realtime-notification:3646452463"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3646452463-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3644498953"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3644498953"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>L</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer">lujji</a></span> <span class="badge moderator"><span class="badge-content">Mod</span></span><a data-action="follow" data-user="223501655" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3629732603" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> tovis</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3644498953" data-role="relative-time" class="time-ago" title="Sunday, December 3, 2017 12:47 PM">5 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hi,
 glad you solved it. I actually covered code optimization in my 
bootloader article - some changes were made to SDCC since then, so bit 
manipulations are faster now. Also, you can check out my git repo for 
some additional optimization rules: <a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Flujji%2Fstm8-bare-min%2Fblob%2Fmaster%2Fstm8%2Futil%2Fextra.def%3AeDf_umSK7taw3jX_m0YwYtlUwMo&amp;cuid=4554663" rel="nofollow noopener" title="https://github.com/lujji/stm8-bare-min/blob/master/stm8/util/extra.def">https://github.com/lujji/st...</a></p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3644498953" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1o9u9e1" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1o9u9e1"></li></ul></li><li class="realtime" data-role="realtime-notification:3644498953"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3644623198"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3644623198"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>T</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer">tovis</a></span> <a data-action="follow" data-user="271992919" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3644498953" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> lujji</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3644623198" data-role="relative-time" class="time-ago" title="Sunday, December 3, 2017 2:10 PM">5 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I'm
 glade to hear that you do not abandon this project. Now I'm stuck on 
UART - something wrong I'm sending 0xAA (usual test byte) but receive 
0x80? I'm suspect level problems around MAX3232 used as a driver.<br>I will checkout boot loader later - I need to get working every peripherals.<br>Your work really helpful!</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3644623198" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1o9wx9a" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1o9wx9a"></li></ul></li><li class="realtime" data-role="realtime-notification:3644623198"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3644623198-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3644498953-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3629732603-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3629091550"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3629091550"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>T</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_zUDsoIMuYQ/" data-action="profile" data-tab="" data-username="disqus_zUDsoIMuYQ" target="_blank" rel="noopener noreferrer">tovis</a></span> <a data-action="follow" data-user="271992919" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3629091550" data-role="relative-time" class="time-ago" title="Wednesday, November 22, 2017 8:21 PM">5 years ago</a> <span> <span class="has-edit" data-role="has-edit">edited</span></span></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container" style="height: 374px;"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Well done! Thanks you that write it down!<br>I'm just now started to<br> explore this mcu and tools such as SDCC, but I quickly found some <br>problems. I have tried to build your/mine interrupt driven (1msec) tick <br>counter using TIM4. Use the same technic as you toggle port bit/pin and <br>put this code to isr:<br>PD_ODR  ^= 0B00001000;<br>TIM4_SR &amp;= 0B111111110;<br>(To compile this you need to put --std-sdcc99 option for sdcc)<br>The<br> result was really strange, instead of get a 50-50% duty cycle I have <br>got one pulse with 1msec the second about some nsec(!) and again a msec.<br> After struggling on C code I was take a look at assembly:<br>;    tick.c: 15: PD_ODR  ^= 0b00001000;  // toggle PD3 output<br>    ldw    x, #0x500f<br>    ld    a, (x)<br>    xor    a, #0x08<br>    ld    (x), a<br>;    tick.c: 17: TIM4_SR &amp;= 0b11111110;  // UIF bit<br>    bres    0x5344, #0<br>It seem to be OK, but not too good. I've changed my C code and use inline assembly:<br>__asm__ ("bcpl 0x500F,#3");<br>TIM4_SR &amp;= 0B111111110;</p><p>After compilation I've got:</p><p>;    tick.c: 17: __asm__("bcpl 0x500F,#3");  // this is working!!!<br>    bcpl    0x500F,#3<br>;    tick.c: 18: TIM4_SR &amp;= 0b11111110;  // UIF bit<br>    bres    0x5344, #0</p><p>And<br> it is working as I awaited, 50-50% square wave. Problem, that I can not<br> use predefined constants, also bit complement is equal to bit xor!?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3629091550" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1o0o0ym" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1o0o0ym"></li></ul></li><li class="realtime" data-role="realtime-notification:3629091550"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3629091550-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3342768941"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3342768941"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/ter_min4/" data-action="profile" data-tab="" data-username="ter_min4" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>T</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/ter_min4/" data-action="profile" data-tab="" data-username="ter_min4" target="_blank" rel="noopener noreferrer">ter_min4</a></span> <a data-action="follow" data-user="254089027" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3342768941" data-role="relative-time" class="time-ago" title="Monday, June 5, 2017 4:56 PM">6 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Hello Lujji,<br>I see you used stm8flash<br>Do you happen to know how to sniff USB, so we can also start to flash more than 32kB?<br>Maybe sniff USB while sending limited range like 0x010000 - 0x010010 with ST Visual Progammer (Windows)<br>Somebody posted issue:<br><a href="https://disq.us/url?url=https%3A%2F%2Fgithub.com%2Fvdudouyt%2Fstm8flash%2Fissues%2F36%3Ae8xwPnrXEjAxi7vg1A_VGeC2ny8&amp;cuid=4554663" rel="nofollow noopener" title="https://github.com/vdudouyt/stm8flash/issues/36">https://github.com/vdudouyt...</a><br>Thanks</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3342768941" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1ja750t" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1ja750t"></li></ul></li><li class="realtime" data-role="realtime-notification:3342768941"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3346924740"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3346924740"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>L</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer">lujji</a></span> <span class="badge moderator"><span class="badge-content">Mod</span></span><a data-action="follow" data-user="223501655" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3342768941" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> ter_min4</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3346924740" data-role="relative-time" class="time-ago" title="Wednesday, June 7, 2017 4:02 PM">6 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Wireshark
 is the best tool for the job if you want to sniff USB. Unfortunately, I
 don't have any 64k parts on hand so I can't help much.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3346924740" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1jco7no" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1jco7no"></li></ul></li><li class="realtime" data-role="realtime-notification:3346924740"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3346924740-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3342768941-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3277049118"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3277049118"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>А</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer">Анна Макарова</a></span> <a data-action="follow" data-user="244831312" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3277049118" data-role="relative-time" class="time-ago" title="Thursday, April 27, 2017 11:23 AM">6 years ago</a> <span> <span class="has-edit" data-role="has-edit">edited</span></span></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I've encountered <a href="http://disq.us/url?url=http%3A%2F%2Fwww.st.com%2Fen%2Fdevelopment-tools%2Fstm8cubemx.html%3A51jsc4XfMgrWdj7RmCBoPuILdxs&amp;cuid=4554663" rel="nofollow noopener" title="http://www.st.com/en/development-tools/stm8cubemx.html">http://www.st.com/en/develo...</a><br>Runs
 on my Linux Mint very well. Unfortunatelly, does not really generate 
code templates with HW initializations (yet?). I''m reading their manual
 just now. Power calculator section in the app hints that power 
consumption is different for the code being executed from RAM compared 
to FLASH. Speed can be different also. Have you tries to place your code
 in RAM and gather some real experience?</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3277049118" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1i72ja6" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1i72ja6"></li></ul></li><li class="realtime" data-role="realtime-notification:3277049118"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3278713069"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3278713069"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>А</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer">Анна Макарова</a></span> <a data-action="follow" data-user="244831312" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3277049118" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Анна Макарова</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3278713069" data-role="relative-time" class="time-ago" title="Friday, April 28, 2017 9:49 AM">6 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Apparently,
 on some STM8's people copy some code to RAM then jump there turning 
FLASH memory off completely somehow. Together with low power oscillator 
it allows them to conserve lots of power while not sleeping entirely. I 
wonder if it's possible on the cheapest one we have. Also there is FLASH
 overclocking limitation that could be potentially overridden with RAM 
fetching. I wonder how many people have tried to squeeze as much as 
possible from STM8003 in terms mentioned above (starting from extreme 
power saving while working from RAM, till extreme overclocking yet with 
the same RAM-based code).</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3278713069" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1i82771" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1i82771"></li></ul></li><li class="realtime" data-role="realtime-notification:3278713069"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3279741884"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3279741884"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>L</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer">lujji</a></span> <span class="badge moderator"><span class="badge-content">Mod</span></span><a data-action="follow" data-user="223501655" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3278713069" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Анна Макарова</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3279741884" data-role="relative-time" class="time-ago" title="Friday, April 28, 2017 9:10 PM">6 years ago</a> </span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I
 haven't tried executing code from RAM - I'll need to figure out if it's
 possible to create a separate RAM section with sdcc's linker. Also 
Cosmic has some built-in functions for copying things into RAM which 
would probably need to be re-implemented in assembly for sdcc. According
 to the datasheet the difference in power consumption between executing 
from flash and RAM is about 3% when running on 128kHz LSI, which is 
negligible. Turning the flash off seems to make a huge difference in 
halt mode.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">1</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3279741884" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1i8o918" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1i8o918"></li></ul></li><li class="realtime" data-role="realtime-notification:3279741884"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3279741884-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3278713069-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3277049118-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li><li class="post" id="post-3255631537"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3255631537"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>А</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer">Анна Макарова</a></span> <a data-action="follow" data-user="244831312" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3255631537" data-role="relative-time" class="time-ago" title="Friday, April 14, 2017 6:37 AM">6 years ago</a> <span> <span class="has-edit" data-role="has-edit">edited</span></span></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>AC
 clocking was epic, and it was fun to find out than ST themselves use AC
 mains as sample frequency source to trim internal HSI generator 
compensation voltage and temperature determined drift. Actually, I'm 
interested in realtime HSI frequency calibration while emulating some 
high-speed protocols\signals where clock accuracy is essential. This 
principleis used in various vUSB implementations even in crystal-less 
mass-produced USB devices.<br>ST recommends calibration examples from 
"firmware library", but last mention of it was 6 years ago and I can not
 find it after their site rebuilt.</p><p>Has anyone tried to play with 
HSI trimming in realtime? The calibration range seems to be not too wide
 (-4..+3) and I wonder if it is enough and are there any glitches during
 runtime.</p><p>Talking about internal memories of STM8, I wonder what 
are their top frequencies (while overclocking), especially while working
 on low-voltage batteries...</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3255631537" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1hubhdd" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1hubhdd"></li></ul></li><li class="realtime" data-role="realtime-notification:3255631537"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3256597156"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3256597156"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>L</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_Dga2cDKSKa/" data-action="profile" data-tab="" data-username="disqus_Dga2cDKSKa" target="_blank" rel="noopener noreferrer">lujji</a></span> <span class="badge moderator"><span class="badge-content">Mod</span></span><a data-action="follow" data-user="223501655" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3255631537" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> Анна Макарова</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3256597156" data-role="relative-time" class="time-ago" title="Friday, April 14, 2017 7:43 PM">6 years ago</a> <span> <span class="has-edit" data-role="has-edit">edited</span></span></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>I haven't read this appnote before and was a bit surprised that ST used mains as frequency reference.<br>Adjusting
 HSI trimming value on the fly is possible, the transition is 
glitch-free. Actually, the first thing I thought about was frequency 
modulation - too bad there's no internal PLL.<br>edit: your reply was blocked by disqus for some reason - fixed.</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-1" data-action="upvote" title="" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">1</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3256597156" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1huw6g4" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1huw6g4"></li></ul></li><li class="realtime" data-role="realtime-notification:3256597156"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"><li class="post" id="post-3257109452"><div role="alert"></div><div data-role="post-content" class="post-content" tabindex="0"><div class="indicator"></div><span class="pinned-icon"></span><ul class="post-menu dropdown post-menu--refresh" data-role="menu" data-view-id="post-menu" data-post-id="3257109452"><li class="post-menu-item collapse"><a href="#" data-action="collapse" title="Collapse" name="Collapse"><span>−</span></a></li><li class="post-menu-item expand"><a href="#" data-action="collapse" title="Expand" name="Collapse"><span>+</span></a></li><li class=" post-menu-item" role="menuitem"><a class="dropdown-toggle" href="#" data-action="flag" data-role="flag" title="Flag as inappropriate"><i aria-hidden="true" class="icon icon-flag"></i></a></li></ul><div class="avatar hovercard"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer" class="user user--refresh"><div>А</div></a></div><div class="post-body"><header class="comment__header"><span class="post-byline"><span> <span class="author publisher-anchor-color"><a href="https://disqus.com/by/disqus_mMEnKVg9HP/" data-action="profile" data-tab="" data-username="disqus_mMEnKVg9HP" target="_blank" rel="noopener noreferrer">Анна Макарова</a></span> <a data-action="follow" data-user="244831312" class="follow-user-container" tabindex="0"><span class="follow-user" aria-label="Follow" title="Follow"></span></a></span><span class="parent-link-container"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3256597156" class="parent-link" data-role="parent-link"><i aria-label="in reply to" class="icon-forward" title="in reply to"></i> lujji</a></span></span>  <span class="post-meta" style="display: block;"> <a href="https://lujji.github.io/blog/bare-metal-programming-stm8-part2/#comment-3257109452" data-role="relative-time" class="time-ago" title="Saturday, April 15, 2017 7:14 AM">6 years ago</a> <span> <span class="has-edit" data-role="has-edit">edited</span></span></span> </header><div class="post-body-inner"><div class="post-message-container" data-role="message-container"><div class="publisher-anchor-color" data-role="message-content"><div class="post-message " data-role="message" dir="auto"><div><p>Absence
 of PLL disappoints me too. Some protocols do need basic frequencies 
different from even harmonics of 16Mhz (slow USB needs multiples of 12 
Mhz, slow Ethernet - 10Mhz, etc.). Being unable to use external crystal 
we'll stuck with indirect target frequency reconstruction based on 
received signals from it and real-time phase\frequency compensation of 
our own clock (basically it's a реrvеrtеd kind of software-emulated 
PLL). As far as I understand, overclocking is possible only with 
external crystal too. People use 40 Mhz external crystal, divide it by 2
 and clock the core at 20 Mhz while peripherals run at 40 MHz. Division 
by 2 is used cause apparently flash can not be read at 40 Mhz.</p><p>edit: my reply contains one suspicious word leading to automated blockage, now I encoded with some tricks)</p></div></div><span class="post-media"><ul data-role="post-media-list"></ul></span></div></div><a class="see-more hidden" title="see more" data-action="see-more">see more</a></div><footer class="comment__footer"><menu class="comment-footer__menu"><li class="voting" data-role="voting"><div class="post-votes"><a href="#" class="vote-up  count-0" data-action="upvote" title="Vote up" name="Vote up"><span class="control"></span> <span class="updatable count" data-role="likes">0</span></a><a href="#" class="vote-down  count-0" data-action="downvote" title="Vote down" name="Vote down"><span class="control"></span> <span class="updatable count" data-role="dislikes">0</span></a></div></li><li class="reply" data-role="reply-link"><a class="comment-footer__action" href="#" data-action="reply"><span class="text">Reply</span></a></li><li class="bullet" aria-hidden="true">•</li><li id="comment__share-3257109452" class="comment__share"><a class="toggle" href="#" data-action="expand-share"><span class="text">Share ›</span></a><ul class="comment-share__buttons"><div class="comment-share__social-share-buttons"><li class="twitter share__button-container"><button class="share__button icon icon-twitter" data-action="share:twitter" aria-label="Share comment on Twitter"></button></li><li class="facebook share__button-container"><button class="share__button icon icon-facebook" data-action="share:facebook" aria-label="Share comment on Facebook"></button></li></div><li class="link share__button-container"><button class="share__button icon icon-link" value="http://disq.us/p/1hv75qk" name="Link" title="Click to copy post link" data-action="copy-link" aria-label="Copy link to comment"></button><input class="share__button link_url" name="Link" title="Click to copy post link" data-action="copy-link" readonly="readonly" value="http://disq.us/p/1hv75qk"></li></ul></li><li class="realtime" data-role="realtime-notification:3257109452"><span style="display: none;" class="realtime-replies realtime-replies--refresh icon icon-pencil"></span><a style="display: none;" href="#" class="realtime-button realtime-button--refresh"></a></li></menu></footer></div><div class="moderate-form blacklist-form" data-role="blacklist-form"></div><div class="moderate-form flag-form" data-role="flagging-form"></div><div class="badges-form" data-role="badges-form"></div><div class="reply-form-container" data-role="reply-form"></div></div><div class="children"><ul data-role="children"></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3257109452-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3256597156-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="show-children-wrapper hidden"><a class="show-children" id="post-3255631537-show-children" data-action="show-children" href="#">Show more replies</a></div></div></li></ul><div class="load-more-refresh load-more-refresh--v2" data-role="more" style="display: none;"><a href="#" data-action="more-posts" class="btn load-more-refresh__button ">Load more comments</a></div></div></section><div id="placement-bottom" data-tracking-area="discovery-south"></div><footer id="footer" data-tracking-area="footer" class="disqus-footer__wrapper disqus-footer__wrapper--refresh"><div><div class="disqus-footer disqus-footer--refresh"><ul class="disqus-footer__list"><li id="thread-subscribe-button" class="email disqus-footer__item disqus-footer__item--refresh"><div class="default"><a href="#" rel="nofollow" data-action="subscribe" title="Subscribe and get email updates from this discussion" class="disqus-footer__link disqus-footer__link--refresh"><div class="icon-wrapper"><i aria-hidden="true" class="icon-subscribe-refresh"></i></div><i aria-hidden="true" class="icon icon-checkmark"></i><span id="thread-subscribe-text-default" class="text-item">Subscribe</span><span id="thread-subscribe-text-subscribed" class="text-item hidden">Subscribed</span></a></div></li><li class="privacy disqus-footer__item disqus-footer__item--refresh"><a href="https://help.disqus.com/customer/portal/articles/466259-privacy-policy" rel="nofollow noopener noreferrer" target="_blank" class="disqus-footer__link disqus-footer__link--refresh" title="Privacy"><div class="icon-wrapper"><i aria-hidden="true" class="icon-privacy-refresh"></i></div><span class="text-item">Privacy</span></a></li><li class="do-not-sell disqus-footer__item disqus-footer__item--refresh"><a href="https://disqus.com/data-sharing-settings/" rel="nofollow noopener noreferrer" target="_blank" class="disqus-footer__link disqus-footer__link--refresh"><div class="icon-wrapper"><i aria-hidden="true" class="icon-warning-refresh"></i></div><span class="text-item">Do Not Sell My Data</span></a></li></ul><span class="disqus-footer__logo"><a href="https://disqus.com/" rel="nofollow" title="Powered by Disqus" class="disqus-footer__link disqus-footer__link--refresh">Powered by Disqus</a></span></div></div></footer></div></div></div></div></body></html>